
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Kasal application">
      
      
        <meta name="author" content="Kasal Team">
      
      
      
        <link rel="prev" href="../AUTHORIZATION/">
      
      
        <link rel="next" href="../REPOSITORY_PATTERN/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Security Model - Kasal Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#security-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kasal Documentation" class="md-header__button md-logo" aria-label="Kasal Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kasal Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Security Model
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/yourusername/kasal" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    kasal
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../GETTING_STARTED/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ARCHITECTURE/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../generation/" class="md-tabs__link">
          
  
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../zustand/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kasal Documentation" class="md-nav__button md-logo" aria-label="Kasal Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Kasal Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/yourusername/kasal" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    kasal
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../GETTING_STARTED/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BEST_PRACTICES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Best Practices
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AUTHORIZATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Security Model
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Security Model
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Core Security Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Security Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-privacy-by-default" class="md-nav__link">
    <span class="md-ellipsis">
      1. Privacy by Default
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-explicit-group-membership" class="md-nav__link">
    <span class="md-ellipsis">
      2. Explicit Group Membership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-least-privilege-access" class="md-nav__link">
    <span class="md-ellipsis">
      3. Least Privilege Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-defense-in-depth" class="md-nav__link">
    <span class="md-ellipsis">
      4. Defense in Depth
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-based-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Group-Based Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group-Based Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-group-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Group Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-group-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Group Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#role-based-access-control-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      Role-Based Access Control (RBAC)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role-Based Access Control (RBAC)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#role-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      Role Hierarchy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role Hierarchy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-viewer-read-only-access" class="md-nav__link">
    <span class="md-ellipsis">
      1. Viewer - Read-only access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-user-standard-workflow-execution" class="md-nav__link">
    <span class="md-ellipsis">
      2. User - Standard workflow execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-manager-team-management-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      3. Manager - Team management capabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-admin-full-administrative-control" class="md-nav__link">
    <span class="md-ellipsis">
      4. Admin - Full administrative control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privilege-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Privilege Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privilege Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privilege-constants" class="md-nav__link">
    <span class="md-ellipsis">
      Privilege Constants
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-privilege-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Role-Privilege Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Checking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decorator-for-endpoint-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Decorator for Endpoint Protection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Database-Level Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database-Level Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-workflow-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Workflow Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration &amp; Templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Logging &amp; Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-group-management" class="md-nav__link">
    <span class="md-ellipsis">
      User &amp; Group Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-level-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Query-Level Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-layer-isolation-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Layer Isolation Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi-Layer Isolation Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-request-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Request-Level Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api-endpoint-isolation-with-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      2. API Endpoint Isolation with RBAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-service-level-isolation-with-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      3. Service-Level Isolation with RBAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-repository-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      4. Repository-Level Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-database-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      5. Database-Level Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprehensive-isolation-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Isolation Mechanisms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprehensive Isolation Mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ai-generation-services-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      AI Generation Services Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AI Generation Services Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llm-interaction-logging" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Interaction Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llm-log-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Log Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-workflow-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Workflow Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Workflow Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-history-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Execution History Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-logs-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Logs Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduler-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduler Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduler Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheduled-job-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Job Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crew-management-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Crew Management Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crew Management Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crew-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Crew Access Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frontend-isolation-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Frontend Isolation Mechanisms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frontend Isolation Mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-service-layer-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      API Service Layer Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-level-data-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Component-Level Data Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-creation-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Creation Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Creation Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-group-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Group Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-validation-on-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Group Validation on Updates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-service-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Service Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Service Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-to-service-group-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      Service-to-Service Group Propagation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#individual-vs-group-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Individual vs Group Permissions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Individual vs Group Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Group Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-management" class="md-nav__link">
    <span class="md-ellipsis">
      Group Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Group Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      User Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Group Deletion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication &amp; Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Request Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-context" class="md-nav__link">
    <span class="md-ellipsis">
      Headers &amp; Context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-context-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Group Context Resolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-guarantees" class="md-nav__link">
    <span class="md-ellipsis">
      Security Guarantees
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Guarantees">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-isolation-guarantees" class="md-nav__link">
    <span class="md-ellipsis">
      Data Isolation Guarantees
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      Audit &amp; Compliance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-retention" class="md-nav__link">
    <span class="md-ellipsis">
      Data Retention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threat-model" class="md-nav__link">
    <span class="md-ellipsis">
      Threat Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Threat Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threats-mitigated" class="md-nav__link">
    <span class="md-ellipsis">
      Threats Mitigated
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Threats Mitigated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unauthorized-data-access" class="md-nav__link">
    <span class="md-ellipsis">
      1. Unauthorized Data Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-group-data-leakage" class="md-nav__link">
    <span class="md-ellipsis">
      2. Group Data Leakage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Privilege Escalation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-admin-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      4. Admin Abuse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#residual-risks" class="md-nav__link">
    <span class="md-ellipsis">
      Residual Risks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Residual Risks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-platform-admin-access" class="md-nav__link">
    <span class="md-ellipsis">
      1. Platform Admin Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-application-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      2. Application Vulnerabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-backupexport-data" class="md-nav__link">
    <span class="md-ellipsis">
      3. Backup/Export Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-id-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Group ID Generation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group ID Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Shared Groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-schema-security" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Group Columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreign-key-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Foreign Key Constraints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-security-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      API Security Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-context-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Group Context Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Query Filtering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-upgrade-path" class="md-nav__link">
    <span class="md-ellipsis">
      Migration &amp; Upgrade Path
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration &amp; Upgrade Path">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-domain-based-to-hybrid-model" class="md-nav__link">
    <span class="md-ellipsis">
      From Domain-Based to Hybrid Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#individual-user-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Individual User Migration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../REPOSITORY_PATTERN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Repository Pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Database
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DATABASE_MIGRATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DATABASE_SEEDING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Seeding
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MODELS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Schemas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Schemas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SCHEMAS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SCHEMAS_STRUCTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Structure
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generation Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CREWAI_ENGINE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CrewAI Engine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LLM_MANAGER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../LOGGING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../task/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../job/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jobs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crew/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Crew
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zustand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zustand State Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nodeDecorator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node Decorators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shortcuts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shortcuts
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Core Security Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Security Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-privacy-by-default" class="md-nav__link">
    <span class="md-ellipsis">
      1. Privacy by Default
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-explicit-group-membership" class="md-nav__link">
    <span class="md-ellipsis">
      2. Explicit Group Membership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-least-privilege-access" class="md-nav__link">
    <span class="md-ellipsis">
      3. Least Privilege Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-defense-in-depth" class="md-nav__link">
    <span class="md-ellipsis">
      4. Defense in Depth
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-based-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Group-Based Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group-Based Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-group-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Group Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-group-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Group Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#role-based-access-control-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      Role-Based Access Control (RBAC)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role-Based Access Control (RBAC)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#role-hierarchy" class="md-nav__link">
    <span class="md-ellipsis">
      Role Hierarchy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Role Hierarchy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-viewer-read-only-access" class="md-nav__link">
    <span class="md-ellipsis">
      1. Viewer - Read-only access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-user-standard-workflow-execution" class="md-nav__link">
    <span class="md-ellipsis">
      2. User - Standard workflow execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-manager-team-management-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      3. Manager - Team management capabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-admin-full-administrative-control" class="md-nav__link">
    <span class="md-ellipsis">
      4. Admin - Full administrative control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#privilege-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Privilege Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Privilege Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#privilege-constants" class="md-nav__link">
    <span class="md-ellipsis">
      Privilege Constants
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-privilege-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Role-Privilege Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Checking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#decorator-for-endpoint-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Decorator for Endpoint Protection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Database-Level Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database-Level Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-workflow-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Workflow Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration &amp; Templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logging-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Logging &amp; Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-group-management" class="md-nav__link">
    <span class="md-ellipsis">
      User &amp; Group Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-level-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Query-Level Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-layer-isolation-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Layer Isolation Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi-Layer Isolation Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-request-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Request-Level Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api-endpoint-isolation-with-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      2. API Endpoint Isolation with RBAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-service-level-isolation-with-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      3. Service-Level Isolation with RBAC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-repository-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      4. Repository-Level Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-database-level-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      5. Database-Level Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprehensive-isolation-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Isolation Mechanisms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comprehensive Isolation Mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ai-generation-services-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      AI Generation Services Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AI Generation Services Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llm-interaction-logging" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Interaction Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#llm-log-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      LLM Log Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-workflow-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Workflow Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution Workflow Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#execution-history-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Execution History Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-logs-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Logs Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduler-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduler Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduler Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheduled-job-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Job Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crew-management-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Crew Management Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crew Management Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crew-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      Crew Access Control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frontend-isolation-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      Frontend Isolation Mechanisms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frontend Isolation Mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-service-layer-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      API Service Layer Isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#component-level-data-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Component-Level Data Isolation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-creation-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Data Creation Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Creation Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-group-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Group Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-validation-on-updates" class="md-nav__link">
    <span class="md-ellipsis">
      Group Validation on Updates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-service-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Service Isolation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Service Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service-to-service-group-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      Service-to-Service Group Propagation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#individual-vs-group-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Individual vs Group Permissions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Individual vs Group Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Group Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#group-management" class="md-nav__link">
    <span class="md-ellipsis">
      Group Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Group Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      User Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Group Deletion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication &amp; Authorization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication &amp; Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Request Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#headers-context" class="md-nav__link">
    <span class="md-ellipsis">
      Headers &amp; Context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-context-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Group Context Resolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-guarantees" class="md-nav__link">
    <span class="md-ellipsis">
      Security Guarantees
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Guarantees">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-isolation-guarantees" class="md-nav__link">
    <span class="md-ellipsis">
      Data Isolation Guarantees
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audit-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      Audit &amp; Compliance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-retention" class="md-nav__link">
    <span class="md-ellipsis">
      Data Retention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#threat-model" class="md-nav__link">
    <span class="md-ellipsis">
      Threat Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Threat Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threats-mitigated" class="md-nav__link">
    <span class="md-ellipsis">
      Threats Mitigated
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Threats Mitigated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unauthorized-data-access" class="md-nav__link">
    <span class="md-ellipsis">
      1. Unauthorized Data Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-group-data-leakage" class="md-nav__link">
    <span class="md-ellipsis">
      2. Group Data Leakage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-privilege-escalation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Privilege Escalation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-admin-abuse" class="md-nav__link">
    <span class="md-ellipsis">
      4. Admin Abuse
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#residual-risks" class="md-nav__link">
    <span class="md-ellipsis">
      Residual Risks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Residual Risks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-platform-admin-access" class="md-nav__link">
    <span class="md-ellipsis">
      1. Platform Admin Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-application-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      2. Application Vulnerabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-backupexport-data" class="md-nav__link">
    <span class="md-ellipsis">
      3. Backup/Export Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-id-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Group ID Generation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group ID Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#individual-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Shared Groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-schema-security" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema Security
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema Security">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Group Columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foreign-key-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Foreign Key Constraints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api-security-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      API Security Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Security Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#group-context-dependency" class="md-nav__link">
    <span class="md-ellipsis">
      Group Context Dependency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Query Filtering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-upgrade-path" class="md-nav__link">
    <span class="md-ellipsis">
      Migration &amp; Upgrade Path
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration &amp; Upgrade Path">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-domain-based-to-hybrid-model" class="md-nav__link">
    <span class="md-ellipsis">
      From Domain-Based to Hybrid Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#individual-user-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Individual User Migration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="security-model">Security Model<a class="headerlink" href="#security-model" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Kasal implements a comprehensive hybrid multi-group security model with Role-Based Access Control (RBAC) that provides both individual privacy and team collaboration capabilities. The system automatically adapts security boundaries based on group membership without requiring user configuration.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#core-security-principles">Core Security Principles</a></li>
<li><a href="#group-based-architecture">Group-Based Architecture</a></li>
<li><a href="#role-based-access-control-rbac">Role-Based Access Control (RBAC)</a></li>
<li><a href="#data-isolation">Data Isolation</a></li>
<li><a href="#group-management">Group Management</a></li>
<li><a href="#authentication--authorization">Authentication &amp; Authorization</a></li>
<li><a href="#security-guarantees">Security Guarantees</a></li>
<li><a href="#threat-model">Threat Model</a></li>
<li><a href="#implementation-details">Implementation Details</a></li>
</ul>
<h2 id="core-security-principles">Core Security Principles<a class="headerlink" href="#core-security-principles" title="Permanent link">&para;</a></h2>
<h3 id="1-privacy-by-default">1. <strong>Privacy by Default</strong><a class="headerlink" href="#1-privacy-by-default" title="Permanent link">&para;</a></h3>
<ul>
<li>Users without group assignments get complete data isolation</li>
<li>Individual group IDs ensure no cross-user data access</li>
<li>Zero trust approach - access must be explicitly granted</li>
</ul>
<h3 id="2-explicit-group-membership">2. <strong>Explicit Group Membership</strong><a class="headerlink" href="#2-explicit-group-membership" title="Permanent link">&para;</a></h3>
<ul>
<li>Group access requires admin-managed assignments</li>
<li>No automatic group enrollment based on email domains</li>
<li>Clear audit trail of all group assignments</li>
</ul>
<h3 id="3-least-privilege-access">3. <strong>Least Privilege Access</strong><a class="headerlink" href="#3-least-privilege-access" title="Permanent link">&para;</a></h3>
<ul>
<li>Role-based permissions within groups (Admin, Manager, User, Viewer)</li>
<li>Users only see data from their assigned groups</li>
<li>Granular privilege system for fine-grained control</li>
</ul>
<h3 id="4-defense-in-depth">4. <strong>Defense in Depth</strong><a class="headerlink" href="#4-defense-in-depth" title="Permanent link">&para;</a></h3>
<ul>
<li>Multiple layers of security controls</li>
<li>Database-level group isolation</li>
<li>Application-level access controls with RBAC</li>
<li>API-level authentication and authorization</li>
</ul>
<h2 id="group-based-architecture">Group-Based Architecture<a class="headerlink" href="#group-based-architecture" title="Permanent link">&para;</a></h2>
<h3 id="individual-group-mode">Individual Group Mode<a class="headerlink" href="#individual-group-mode" title="Permanent link">&para;</a></h3>
<p><strong>When Applied:</strong>
- User is not assigned to any groups
- Group lookup fails or returns empty results
- Fallback security mode for maximum isolation</p>
<p><strong>Security Characteristics:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>User: alice@company.com
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>Group ID: user_alice_company_com
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Access Scope: Only Alice&#39;s data
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>Role: Full admin rights (within own group)
</code></pre></div></p>
<p><strong>Data Isolation:</strong>
- Execution history: Only Alice's workflows
- Agents &amp; Tasks: Only Alice's creations
- Crews: Only Alice's team configurations
- Logs: Only Alice's execution logs</p>
<h3 id="multi-group-mode">Multi-Group Mode<a class="headerlink" href="#multi-group-mode" title="Permanent link">&para;</a></h3>
<p><strong>When Applied:</strong>
- User is assigned to one or more groups
- Admin has explicitly granted group membership
- User belongs to active groups</p>
<p><strong>Security Characteristics:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>User: bob@company.com
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>Groups: [&quot;dev_team&quot;, &quot;qa_team&quot;]
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>Group IDs: [&quot;dev_team&quot;, &quot;qa_team&quot;]
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>Roles: {&quot;dev_team&quot;: &quot;admin&quot;, &quot;qa_team&quot;: &quot;user&quot;}
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>Access Scope: Data from both teams (role-dependent)
</code></pre></div></p>
<p><strong>Data Isolation:</strong>
- Execution history: From all assigned groups
- Agents &amp; Tasks: Shared team resources (role-dependent access)
- Crews: Team configurations (role-dependent modification)
- Logs: Team execution logs (role-dependent visibility)</p>
<h2 id="role-based-access-control-rbac">Role-Based Access Control (RBAC)<a class="headerlink" href="#role-based-access-control-rbac" title="Permanent link">&para;</a></h2>
<h3 id="role-hierarchy">Role Hierarchy<a class="headerlink" href="#role-hierarchy" title="Permanent link">&para;</a></h3>
<p>The system implements a four-tier role hierarchy with increasing privileges:</p>
<h4 id="1-viewer-read-only-access">1. <strong>Viewer</strong> - Read-only access<a class="headerlink" href="#1-viewer-read-only-access" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Group Privileges:</strong></li>
<li><code>group:read</code> - View group information</li>
<li><strong>Workflow Privileges:</strong></li>
<li><code>workflow:read</code> - View workflows and executions</li>
<li><code>execution_history:read</code> - View execution history</li>
<li><code>execution_logs:read</code> - View execution logs</li>
<li><strong>Resource Privileges:</strong></li>
<li><code>agent:read</code>, <code>task:read</code>, <code>crew:read</code> - View team resources</li>
<li><code>template:read</code>, <code>tool:read</code> - View shared templates and tools</li>
</ul>
<h4 id="2-user-standard-workflow-execution">2. <strong>User</strong> - Standard workflow execution<a class="headerlink" href="#2-user-standard-workflow-execution" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Inherits all Viewer privileges, plus:</strong></li>
<li><strong>Workflow Privileges:</strong></li>
<li><code>workflow:create</code>, <code>workflow:update</code>, <code>workflow:delete</code> - Manage workflows</li>
<li><code>workflow:execute</code> - Execute workflows</li>
<li><code>execution:create</code> - Create executions</li>
<li><strong>Resource Privileges:</strong></li>
<li><code>agent:create</code>, <code>agent:update</code>, <code>agent:delete</code> - Manage agents</li>
<li><code>task:create</code>, <code>task:update</code>, <code>task:delete</code> - Manage tasks</li>
<li><code>crew:create</code>, <code>crew:update</code>, <code>crew:delete</code> - Manage crews</li>
<li><code>template:create</code>, <code>template:update</code> - Create and edit templates</li>
<li><strong>Limited Tool Access:</strong></li>
<li><code>tool:create</code>, <code>tool:update</code> - Create and modify personal tools</li>
</ul>
<h4 id="3-manager-team-management-capabilities">3. <strong>Manager</strong> - Team management capabilities<a class="headerlink" href="#3-manager-team-management-capabilities" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Inherits all User privileges, plus:</strong></li>
<li><strong>User Management:</strong></li>
<li><code>group:manage_users</code> - Add/remove users from group</li>
<li><code>user:update_role</code> - Change user roles (up to Manager level)</li>
<li><strong>Advanced Resource Management:</strong></li>
<li><code>tool:delete</code> - Delete tools</li>
<li><code>template:delete</code> - Delete templates</li>
<li><code>schedule:create</code>, <code>schedule:update</code>, <code>schedule:delete</code> - Manage schedules</li>
<li><strong>Team Operations:</strong></li>
<li><code>execution:stop</code>, <code>execution:restart</code> - Control team executions</li>
<li><code>logs:export</code> - Export team logs</li>
</ul>
<h4 id="4-admin-full-administrative-control">4. <strong>Admin</strong> - Full administrative control<a class="headerlink" href="#4-admin-full-administrative-control" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Inherits all Manager privileges, plus:</strong></li>
<li><strong>Group Administration:</strong></li>
<li><code>group:create</code>, <code>group:update</code>, <code>group:delete</code> - Full group management</li>
<li><code>group:manage_roles</code> - Assign any role including Admin</li>
<li><strong>System Operations:</strong></li>
<li><code>user:create</code>, <code>user:delete</code> - Manage user accounts</li>
<li><code>system:backup</code>, <code>system:restore</code> - System-level operations</li>
<li><strong>Security Management:</strong></li>
<li><code>audit:read</code> - Access audit logs</li>
<li><code>security:manage</code> - Manage security settings</li>
</ul>
<h3 id="permission-matrix">Permission Matrix<a class="headerlink" href="#permission-matrix" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Viewer</th>
<th>User</th>
<th>Manager</th>
<th>Admin</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Group Management</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>View group info</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Manage users</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Manage roles</td>
<td></td>
<td></td>
<td>Limited</td>
<td></td>
</tr>
<tr>
<td>Delete group</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Workflows</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>View workflows</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Create/Edit workflows</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Execute workflows</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Delete workflows</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Resources (Agents/Tasks/Crews)</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>View resources</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Create resources</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Edit own resources</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Edit team resources</td>
<td></td>
<td>Limited</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Delete resources</td>
<td></td>
<td>Own only</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Execution &amp; Logs</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>View execution history</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>View execution logs</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Stop executions</td>
<td></td>
<td>Own only</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Export logs</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Tools &amp; Templates</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>View tools/templates</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Create tools/templates</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Edit tools/templates</td>
<td></td>
<td>Own only</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Delete tools/templates</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="privilege-implementation">Privilege Implementation<a class="headerlink" href="#privilege-implementation" title="Permanent link">&para;</a></h3>
<h4 id="privilege-constants">Privilege Constants<a class="headerlink" href="#privilege-constants" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Privileges</span><span class="p">:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="c1"># Group Management</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">GROUP_CREATE</span> <span class="o">=</span> <span class="s2">&quot;group:create&quot;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">GROUP_READ</span> <span class="o">=</span> <span class="s2">&quot;group:read&quot;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">GROUP_UPDATE</span> <span class="o">=</span> <span class="s2">&quot;group:update&quot;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">GROUP_DELETE</span> <span class="o">=</span> <span class="s2">&quot;group:delete&quot;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">GROUP_MANAGE_USERS</span> <span class="o">=</span> <span class="s2">&quot;group:manage_users&quot;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">GROUP_MANAGE_ROLES</span> <span class="o">=</span> <span class="s2">&quot;group:manage_roles&quot;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="c1"># Workflow Management</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">WORKFLOW_CREATE</span> <span class="o">=</span> <span class="s2">&quot;workflow:create&quot;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">WORKFLOW_READ</span> <span class="o">=</span> <span class="s2">&quot;workflow:read&quot;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">WORKFLOW_UPDATE</span> <span class="o">=</span> <span class="s2">&quot;workflow:update&quot;</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">WORKFLOW_DELETE</span> <span class="o">=</span> <span class="s2">&quot;workflow:delete&quot;</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">WORKFLOW_EXECUTE</span> <span class="o">=</span> <span class="s2">&quot;workflow:execute&quot;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="c1"># Resource Management</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">AGENT_CREATE</span> <span class="o">=</span> <span class="s2">&quot;agent:create&quot;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="n">AGENT_READ</span> <span class="o">=</span> <span class="s2">&quot;agent:read&quot;</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="n">AGENT_UPDATE</span> <span class="o">=</span> <span class="s2">&quot;agent:update&quot;</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="n">AGENT_DELETE</span> <span class="o">=</span> <span class="s2">&quot;agent:delete&quot;</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>    <span class="c1"># Execution Management</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>    <span class="n">EXECUTION_CREATE</span> <span class="o">=</span> <span class="s2">&quot;execution:create&quot;</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>    <span class="n">EXECUTION_READ</span> <span class="o">=</span> <span class="s2">&quot;execution:read&quot;</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="n">EXECUTION_STOP</span> <span class="o">=</span> <span class="s2">&quot;execution:stop&quot;</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="n">EXECUTION_RESTART</span> <span class="o">=</span> <span class="s2">&quot;execution:restart&quot;</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>    <span class="c1"># And many more...</span>
</code></pre></div>
<h4 id="role-privilege-mapping">Role-Privilege Mapping<a class="headerlink" href="#role-privilege-mapping" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">ROLE_PRIVILEGES</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">GroupUserRole</span><span class="o">.</span><span class="n">VIEWER</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">GROUP_READ</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">WORKFLOW_READ</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">AGENT_READ</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">TASK_READ</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">CREW_READ</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">EXECUTION_READ</span><span class="p">,</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">EXECUTION_HISTORY_READ</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">EXECUTION_LOGS_READ</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="c1"># ... more read-only privileges</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="p">],</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="n">GroupUserRole</span><span class="o">.</span><span class="n">USER</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>        <span class="c1"># Inherits all Viewer privileges +</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">WORKFLOW_CREATE</span><span class="p">,</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">WORKFLOW_UPDATE</span><span class="p">,</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">WORKFLOW_DELETE</span><span class="p">,</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">WORKFLOW_EXECUTE</span><span class="p">,</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">AGENT_CREATE</span><span class="p">,</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">AGENT_UPDATE</span><span class="p">,</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">AGENT_DELETE</span><span class="p">,</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>        <span class="c1"># ... more user privileges</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>    <span class="p">],</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>    <span class="n">GroupUserRole</span><span class="o">.</span><span class="n">MANAGER</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        <span class="c1"># Inherits all User privileges +</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">GROUP_MANAGE_USERS</span><span class="p">,</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">USER_UPDATE_ROLE</span><span class="p">,</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">SCHEDULE_CREATE</span><span class="p">,</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">SCHEDULE_UPDATE</span><span class="p">,</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">SCHEDULE_DELETE</span><span class="p">,</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">EXECUTION_STOP</span><span class="p">,</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">EXECUTION_RESTART</span><span class="p">,</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>        <span class="c1"># ... more manager privileges</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>    <span class="p">],</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>    <span class="n">GroupUserRole</span><span class="o">.</span><span class="n">ADMIN</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>        <span class="c1"># Inherits all Manager privileges +</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">GROUP_CREATE</span><span class="p">,</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">GROUP_UPDATE</span><span class="p">,</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">GROUP_DELETE</span><span class="p">,</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">GROUP_MANAGE_ROLES</span><span class="p">,</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">USER_CREATE</span><span class="p">,</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">USER_DELETE</span><span class="p">,</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">SYSTEM_BACKUP</span><span class="p">,</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>        <span class="n">Privileges</span><span class="o">.</span><span class="n">AUDIT_READ</span><span class="p">,</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>        <span class="c1"># ... all privileges</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>    <span class="p">]</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="p">}</span>
</code></pre></div>
<h4 id="permission-checking">Permission Checking<a class="headerlink" href="#permission-checking" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_permission</span><span class="p">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">required_privilege</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if user has required privilege in group.&quot;&quot;&quot;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="c1"># Get user&#39;s role in the group</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">user_role</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_user_role_in_group</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user_role</span><span class="p">:</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="c1"># Get privileges for that role</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="n">role_privileges</span> <span class="o">=</span> <span class="n">ROLE_PRIVILEGES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_role</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="c1"># Check if privilege is granted</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="k">return</span> <span class="n">required_privilege</span> <span class="ow">in</span> <span class="n">role_privileges</span>
</code></pre></div>
<h4 id="decorator-for-endpoint-protection">Decorator for Endpoint Protection<a class="headerlink" href="#decorator-for-endpoint-protection" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">require_privilege</span><span class="p">(</span><span class="n">privilege</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to protect endpoints with privilege requirements.&quot;&quot;&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>            <span class="c1"># Extract group context and user from request</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>            <span class="n">group_context</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;group_context&#39;</span><span class="p">)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">group_context</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;Group context required&quot;</span><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>            <span class="c1"># Check permission for primary group</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>            <span class="n">has_permission</span> <span class="o">=</span> <span class="k">await</span> <span class="n">check_permission</span><span class="p">(</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>                <span class="n">group_id</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">primary_group_id</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>                <span class="n">required_privilege</span><span class="o">=</span><span class="n">privilege</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>            <span class="p">)</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_permission</span><span class="p">:</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Missing privilege: </span><span class="si">{</span><span class="n">privilege</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>            <span class="k">return</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        <span class="k">return</span> <span class="n">wrapper</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>    <span class="k">return</span> <span class="n">decorator</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="c1"># Usage in endpoints</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/groups/</span><span class="si">{group_id}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="nd">@require_privilege</span><span class="p">(</span><span class="n">Privileges</span><span class="o">.</span><span class="n">GROUP_DELETE</span><span class="p">)</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_group</span><span class="p">(</span><span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContextDep</span><span class="p">):</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete group - requires admin privilege.&quot;&quot;&quot;</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>    <span class="k">await</span> <span class="n">group_service</span><span class="o">.</span><span class="n">delete_group</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>
</code></pre></div>
<h2 id="data-isolation">Data Isolation<a class="headerlink" href="#data-isolation" title="Permanent link">&para;</a></h2>
<h3 id="database-level-isolation">Database-Level Isolation<a class="headerlink" href="#database-level-isolation" title="Permanent link">&para;</a></h3>
<p>All major data entities include group isolation with automatic filtering at every data access point:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">-- Example: Execution History Table</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">execution_history</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="n">group_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="c1">-- Group isolation key</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="n">created_by_email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="w">   </span><span class="c1">-- Audit trail</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="n">job_id</span><span class="w"> </span><span class="n">UUID</span><span class="p">,</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="c1">-- ... other fields</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_group_id</span><span class="w"> </span><span class="p">(</span><span class="n">group_id</span><span class="p">),</span><span class="w">           </span><span class="c1">-- Performance optimization</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_created_by_email</span><span class="w"> </span><span class="p">(</span><span class="n">created_by_email</span><span class="p">)</span><span class="w">  </span><span class="c1">-- Audit queries</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="p">);</span>
</code></pre></div>
<p><strong>Comprehensive Isolated Entities:</strong></p>
<h4 id="core-workflow-components">Core Workflow Components<a class="headerlink" href="#core-workflow-components" title="Permanent link">&para;</a></h4>
<ul>
<li><code>execution_history</code> - All workflow execution records with group isolation</li>
<li><code>execution_logs</code> - Detailed execution logs filtered by group</li>
<li><code>flow_executions</code> - Flow execution instances with group boundaries</li>
<li><code>agents</code> - AI agent definitions scoped to group</li>
<li><code>tasks</code> - Task configurations with group access control</li>
<li><code>crews</code> - Team configurations isolated by group</li>
<li><code>flows</code> - Workflow definitions with group ownership</li>
<li><code>schedules</code> - Scheduled job executions with group filtering</li>
</ul>
<h4 id="configuration-templates">Configuration &amp; Templates<a class="headerlink" href="#configuration-templates" title="Permanent link">&para;</a></h4>
<ul>
<li><code>templates</code> - Reusable prompt templates scoped to group</li>
<li><code>tools</code> - Custom tool definitions with group access</li>
<li><code>model_configs</code> - LLM model configurations per group</li>
<li><code>engine_configs</code> - Execution engine settings by group</li>
</ul>
<h4 id="logging-monitoring">Logging &amp; Monitoring<a class="headerlink" href="#logging-monitoring" title="Permanent link">&para;</a></h4>
<ul>
<li><code>llmlog</code> - LLM API interaction logs with group isolation</li>
<li><code>execution_trace</code> - Detailed execution traces filtered by group</li>
<li><code>api_logs</code> - API access logs with group context</li>
</ul>
<h4 id="user-group-management">User &amp; Group Management<a class="headerlink" href="#user-group-management" title="Permanent link">&para;</a></h4>
<ul>
<li><code>groups</code> - Group definitions and metadata</li>
<li><code>group_users</code> - User-to-group assignments with roles</li>
<li><code>users</code> - User profiles with group associations</li>
<li><code>user_roles</code> - RBAC role assignments within groups</li>
</ul>
<h3 id="query-level-filtering">Query-Level Filtering<a class="headerlink" href="#query-level-filtering" title="Permanent link">&para;</a></h3>
<p>All data queries automatically include group filtering:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Individual user - single group</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">WHERE</span> <span class="n">group_id</span> <span class="o">=</span> <span class="s1">&#39;user_alice_company_com&#39;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1"># Multi-group user - multiple groups</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">WHERE</span> <span class="n">group_id</span> <span class="n">IN</span> <span class="p">(</span><span class="s1">&#39;dev_team&#39;</span><span class="p">,</span> <span class="s1">&#39;qa_team&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="multi-layer-isolation-architecture">Multi-Layer Isolation Architecture<a class="headerlink" href="#multi-layer-isolation-architecture" title="Permanent link">&para;</a></h3>
<p>The system implements isolation at multiple levels to ensure comprehensive data protection:</p>
<h4 id="1-request-level-isolation">1. <strong>Request-Level Isolation</strong><a class="headerlink" href="#1-request-level-isolation" title="Permanent link">&para;</a></h4>
<p>Every HTTP request includes group context extraction with RBAC:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">GroupContext</span><span class="p">:</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">group_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>            <span class="c1"># All accessible group IDs</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">group_email</span><span class="p">:</span> <span class="nb">str</span>                <span class="c1"># User&#39;s email for audit</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">email_domain</span><span class="p">:</span> <span class="nb">str</span>               <span class="c1"># Email domain</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>          <span class="c1"># User identifier</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">access_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>     <span class="c1"># Authentication token</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="n">user_roles</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>      <span class="c1"># Role per group {&quot;group_id&quot;: &quot;role&quot;}</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="nd">@property</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">primary_group_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Primary group for creating new data.&quot;&quot;&quot;</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_ids</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_role_in_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get user&#39;s role in specific group.&quot;&quot;&quot;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_roles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>
</code></pre></div>
<h4 id="2-api-endpoint-isolation-with-rbac">2. <strong>API Endpoint Isolation with RBAC</strong><a class="headerlink" href="#2-api-endpoint-isolation-with-rbac" title="Permanent link">&para;</a></h4>
<p>All API endpoints automatically enforce group boundaries and role-based permissions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># Every endpoint includes group context with role-based filtering</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/executions/&quot;</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nd">@require_privilege</span><span class="p">(</span><span class="n">Privileges</span><span class="o">.</span><span class="n">EXECUTION_READ</span><span class="p">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_executions</span><span class="p">(</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContextDep</span><span class="p">,</span>  <span class="c1"># Automatic group injection with roles</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="p">):</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="c1"># Service automatically filters by group_context.group_ids and user role</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">execution_service</span><span class="o">.</span><span class="n">get_executions_paginated</span><span class="p">(</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>        <span class="n">group_context</span><span class="o">=</span><span class="n">group_context</span><span class="p">,</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> 
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="p">)</span>
</code></pre></div>
<h4 id="3-service-level-isolation-with-rbac">3. <strong>Service-Level Isolation with RBAC</strong><a class="headerlink" href="#3-service-level-isolation-with-rbac" title="Permanent link">&para;</a></h4>
<p>All business logic services respect group boundaries and role permissions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExecutionHistoryService</span><span class="p">:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_executions_paginated</span><span class="p">(</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>        <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>        <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get executions with automatic group filtering and role-based access.&quot;&quot;&quot;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        <span class="c1"># Check user has read permission for executions</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_permission</span><span class="p">(</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>            <span class="n">group_context</span><span class="p">,</span> 
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>            <span class="n">Privileges</span><span class="o">.</span><span class="n">EXECUTION_READ</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>        <span class="p">)</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="c1"># Automatic group ID filtering with role consideration</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_paginated_by_group</span><span class="p">(</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>            <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span><span class="p">,</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>            <span class="n">user_roles</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">user_roles</span><span class="p">,</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>            <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        <span class="p">)</span>
</code></pre></div>
<h4 id="4-repository-level-isolation">4. <strong>Repository-Level Isolation</strong><a class="headerlink" href="#4-repository-level-isolation" title="Permanent link">&para;</a></h4>
<p>Data access layer enforces group filtering at query level:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExecutionHistoryRepository</span><span class="p">:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_paginated_by_group</span><span class="p">(</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>        <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>        <span class="n">group_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>        <span class="n">user_roles</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        <span class="n">page</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Repository ensures group filtering in all queries.&quot;&quot;&quot;</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        <span class="c1"># Base query with group filtering</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>        <span class="n">base_query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">ExecutionHistory</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>            <span class="n">ExecutionHistory</span><span class="o">.</span><span class="n">group_id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>        <span class="p">)</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="c1"># Additional filtering based on user role (if needed)</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="c1"># Viewers might see fewer fields, Users see own + shared, etc.</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>        <span class="c1"># Count query with same group filtering</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        <span class="n">count_query</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ExecutionHistory</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>            <span class="n">ExecutionHistory</span><span class="o">.</span><span class="n">group_id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>        <span class="p">)</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>        <span class="c1"># Both queries automatically respect group boundaries</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>        <span class="c1"># No possibility of cross-group data access</span>
</code></pre></div>
<h4 id="5-database-level-isolation">5. <strong>Database-Level Isolation</strong><a class="headerlink" href="#5-database-level-isolation" title="Permanent link">&para;</a></h4>
<p>Every table includes group columns with indexed access:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">-- All tables follow this pattern</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">execution_history</span><span class="w"> </span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">group_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">created_by_email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">ADD</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_group_id</span><span class="w"> </span><span class="p">(</span><span class="n">group_id</span><span class="p">),</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="k">ADD</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_created_by_email</span><span class="w"> </span><span class="p">(</span><span class="n">created_by_email</span><span class="p">);</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="c1">-- Queries are always group-scoped</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">execution_history</span><span class="w"> </span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">group_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;user_alice_company_com&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dev_team&#39;</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</code></pre></div>
<h2 id="comprehensive-isolation-mechanisms">Comprehensive Isolation Mechanisms<a class="headerlink" href="#comprehensive-isolation-mechanisms" title="Permanent link">&para;</a></h2>
<h3 id="ai-generation-services-isolation">AI Generation Services Isolation<a class="headerlink" href="#ai-generation-services-isolation" title="Permanent link">&para;</a></h3>
<p>All AI-powered generation services (agents, tasks, crews) include group context for complete isolation:</p>
<h4 id="llm-interaction-logging">LLM Interaction Logging<a class="headerlink" href="#llm-interaction-logging" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentGenerationService</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_agent</span><span class="p">(</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>        <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>        <span class="n">prompt_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GroupContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate agent with group-aware logging.&quot;&quot;&quot;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        <span class="c1"># Generate agent configuration</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        <span class="n">agent_config</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_agent_config</span><span class="p">(</span><span class="n">prompt_text</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="c1"># Log interaction with group context</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_llm_interaction</span><span class="p">(</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>            <span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;generate-agent&#39;</span><span class="p">,</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt_text</span><span class="p">,</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>            <span class="n">response</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">agent_config</span><span class="p">),</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>            <span class="n">group_context</span><span class="o">=</span><span class="n">group_context</span>  <span class="c1"># Group isolation for logs</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>        <span class="p">)</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>        <span class="k">return</span> <span class="n">agent_config</span>
</code></pre></div>
<h4 id="llm-log-isolation">LLM Log Isolation<a class="headerlink" href="#llm-log-isolation" title="Permanent link">&para;</a></h4>
<p>Every AI interaction is logged with group boundaries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LLMLogService</span><span class="p">:</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_log</span><span class="p">(</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>        <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="n">response</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>        <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GroupContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMLog</span><span class="p">:</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create LLM log with automatic group isolation.&quot;&quot;&quot;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        <span class="n">log_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>            <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">,</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>            <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>            <span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">,</span> 
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>        <span class="p">}</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        <span class="c1"># Add group fields if context provided</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>        <span class="k">if</span> <span class="n">group_context</span> <span class="ow">and</span> <span class="n">group_context</span><span class="o">.</span><span class="n">primary_group_id</span><span class="p">:</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>            <span class="n">log_data</span><span class="p">[</span><span class="s2">&quot;group_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_context</span><span class="o">.</span><span class="n">primary_group_id</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>            <span class="n">log_data</span><span class="p">[</span><span class="s2">&quot;group_email&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_context</span><span class="o">.</span><span class="n">group_email</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>        <span class="c1"># Log is automatically scoped to group</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">log_data</span><span class="p">)</span>
</code></pre></div>
<h3 id="execution-workflow-isolation">Execution Workflow Isolation<a class="headerlink" href="#execution-workflow-isolation" title="Permanent link">&para;</a></h3>
<h4 id="execution-history-isolation">Execution History Isolation<a class="headerlink" href="#execution-history-isolation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExecutionHistoryService</span><span class="p">:</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_executions_with_group_filter</span><span class="p">(</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>        <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>        <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        <span class="n">flow_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecutionHistory</span><span class="p">]:</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get executions with comprehensive group filtering.&quot;&quot;&quot;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>        <span class="c1"># Multiple filter criteria, all group-scoped</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_filtered_by_group</span><span class="p">(</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>            <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span><span class="p">,</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>            <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">,</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>            <span class="n">flow_id</span><span class="o">=</span><span class="n">flow_id</span><span class="p">,</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>            <span class="c1"># Additional filters automatically respect group boundaries</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>        <span class="p">)</span>
</code></pre></div>
<h4 id="execution-logs-isolation">Execution Logs Isolation<a class="headerlink" href="#execution-logs-isolation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExecutionLogsService</span><span class="p">:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_logs_for_execution</span><span class="p">(</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>        <span class="n">execution_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExecutionLog</span><span class="p">]:</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get execution logs with group validation.&quot;&quot;&quot;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="c1"># First verify execution belongs to user&#39;s groups</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        <span class="n">execution</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_repository</span><span class="o">.</span><span class="n">get_by_id_and_group</span><span class="p">(</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>            <span class="n">execution_id</span><span class="o">=</span><span class="n">execution_id</span><span class="p">,</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>            <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>        <span class="p">)</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">execution</span><span class="p">:</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="s2">&quot;Execution not found or not accessible&quot;</span><span class="p">)</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>        <span class="c1"># Get logs only if execution is accessible</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs_repository</span><span class="o">.</span><span class="n">get_by_execution_and_group</span><span class="p">(</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>            <span class="n">execution_id</span><span class="o">=</span><span class="n">execution_id</span><span class="p">,</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>            <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>        <span class="p">)</span>
</code></pre></div>
<h3 id="scheduler-isolation">Scheduler Isolation<a class="headerlink" href="#scheduler-isolation" title="Permanent link">&para;</a></h3>
<h4 id="scheduled-job-isolation">Scheduled Job Isolation<a class="headerlink" href="#scheduled-job-isolation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SchedulerService</span><span class="p">:</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_schedule</span><span class="p">(</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>        <span class="n">schedule_data</span><span class="p">:</span> <span class="n">ScheduleCreate</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Schedule</span><span class="p">:</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create schedule with group ownership.&quot;&quot;&quot;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>        <span class="c1"># Automatically assign group ownership</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>        <span class="n">schedule_dict</span> <span class="o">=</span> <span class="n">schedule_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>        <span class="n">schedule_dict</span><span class="p">[</span><span class="s1">&#39;group_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_context</span><span class="o">.</span><span class="n">primary_group_id</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>        <span class="n">schedule_dict</span><span class="p">[</span><span class="s1">&#39;created_by_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_context</span><span class="o">.</span><span class="n">group_email</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">create_with_group</span><span class="p">(</span><span class="n">schedule_dict</span><span class="p">)</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_schedules</span><span class="p">(</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Schedule</span><span class="p">]:</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get schedules visible to user&#39;s groups.&quot;&quot;&quot;</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_by_group_ids</span><span class="p">(</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>            <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>        <span class="p">)</span>
</code></pre></div>
<h3 id="crew-management-isolation">Crew Management Isolation<a class="headerlink" href="#crew-management-isolation" title="Permanent link">&para;</a></h3>
<h4 id="crew-access-control">Crew Access Control<a class="headerlink" href="#crew-access-control" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CrewService</span><span class="p">:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_crews</span><span class="p">(</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span><span class="p">,</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>        <span class="n">include_shared</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Crew</span><span class="p">]:</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get crews accessible to user with group filtering.&quot;&quot;&quot;</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>        <span class="k">if</span> <span class="n">include_shared</span><span class="p">:</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>            <span class="c1"># User sees crews from all their assigned groups</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_by_group_ids</span><span class="p">(</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>                <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>            <span class="p">)</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>            <span class="c1"># User sees only crews they created</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_by_creator_and_group</span><span class="p">(</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>                <span class="n">created_by_email</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_email</span><span class="p">,</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>                <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>            <span class="p">)</span>
</code></pre></div>
<h3 id="frontend-isolation-mechanisms">Frontend Isolation Mechanisms<a class="headerlink" href="#frontend-isolation-mechanisms" title="Permanent link">&para;</a></h3>
<h4 id="api-service-layer-isolation">API Service Layer Isolation<a class="headerlink" href="#api-service-layer-isolation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">// Frontend services automatically include group headers</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">ExecutionHistoryService</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getExecutions</span><span class="p">(</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">        </span><span class="nx">page</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">PaginatedResponse</span><span class="o">&lt;</span><span class="nx">ExecutionRun</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">        </span><span class="c1">// Group context automatically extracted from headers</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">        </span><span class="c1">// Backend filters results by user&#39;s accessible groups</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ApiService</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/execution-history/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">            </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">page</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">        </span><span class="c1">// Response contains only group-accessible data</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="p">}</span>
</code></pre></div>
<h4 id="component-level-data-isolation">Component-Level Data Isolation<a class="headerlink" href="#component-level-data-isolation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// Frontend components work with pre-filtered data</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">ExecutionHistory</span><span class="o">:</span><span class="w"> </span><span class="kt">React.FC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">executions</span><span class="p">,</span><span class="w"> </span><span class="nx">setExecutions</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useState</span><span class="o">&lt;</span><span class="nx">ExecutionRun</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">([]);</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="nx">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">loadExecutions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">            </span><span class="c1">// Service returns only group-accessible executions</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">ExecutionHistoryService</span><span class="p">.</span><span class="nx">getExecutions</span><span class="p">();</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">            </span><span class="nx">setExecutions</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">        </span><span class="nx">loadExecutions</span><span class="p">();</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="p">[]);</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="w">    </span><span class="c1">// Component automatically displays group-filtered data</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="c1">// No additional filtering needed in UI layer</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="w">        </span><span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">            </span><span class="p">{</span><span class="nx">executions</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">execution</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">                </span><span class="o">&lt;</span><span class="nx">ExecutionCard</span><span class="w"> </span><span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">execution</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="w"> </span><span class="nx">execution</span><span class="o">=</span><span class="p">{</span><span class="nx">execution</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">            </span><span class="p">))}</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">        </span><span class="o">&lt;</span><span class="err">/div&gt;</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="p">};</span>
</code></pre></div>
<h3 id="data-creation-isolation">Data Creation Isolation<a class="headerlink" href="#data-creation-isolation" title="Permanent link">&para;</a></h3>
<h4 id="automatic-group-assignment">Automatic Group Assignment<a class="headerlink" href="#automatic-group-assignment" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">TaskService</span><span class="p">:</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_with_group</span><span class="p">(</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>        <span class="n">task_data</span><span class="p">:</span> <span class="n">TaskCreate</span><span class="p">,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Task</span><span class="p">:</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create task with automatic group assignment.&quot;&quot;&quot;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>        <span class="c1"># Convert Pydantic model to dict for manipulation</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>        <span class="n">task_dict</span> <span class="o">=</span> <span class="n">task_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>        <span class="c1"># Automatically assign group ownership</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>        <span class="n">task_dict</span><span class="p">[</span><span class="s1">&#39;group_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_context</span><span class="o">.</span><span class="n">primary_group_id</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>        <span class="n">task_dict</span><span class="p">[</span><span class="s1">&#39;created_by_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_context</span><span class="o">.</span><span class="n">group_email</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>        <span class="c1"># Create task with group isolation</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">task_dict</span><span class="p">)</span>
</code></pre></div>
<h4 id="group-validation-on-updates">Group Validation on Updates<a class="headerlink" href="#group-validation-on-updates" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentService</span><span class="p">:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_agent</span><span class="p">(</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>        <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>        <span class="n">agent_update</span><span class="p">:</span> <span class="n">AgentUpdate</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Agent</span><span class="p">:</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update agent with group ownership validation.&quot;&quot;&quot;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>        <span class="c1"># First verify agent belongs to user&#39;s groups</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        <span class="n">existing_agent</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_by_id_and_group</span><span class="p">(</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>            <span class="n">agent_id</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>            <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>        <span class="p">)</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_agent</span><span class="p">:</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="s2">&quot;Agent not found or not accessible&quot;</span><span class="p">)</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>        <span class="c1"># Update only if group validation passes</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">agent_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
</code></pre></div>
<h3 id="cross-service-isolation">Cross-Service Isolation<a class="headerlink" href="#cross-service-isolation" title="Permanent link">&para;</a></h3>
<h4 id="service-to-service-group-propagation">Service-to-Service Group Propagation<a class="headerlink" href="#service-to-service-group-propagation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DispatcherService</span><span class="p">:</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>        <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>        <span class="n">request</span><span class="p">:</span> <span class="n">DispatcherRequest</span><span class="p">,</span> 
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        <span class="n">group_context</span><span class="p">:</span> <span class="n">GroupContext</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch with group context propagation.&quot;&quot;&quot;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        <span class="k">if</span> <span class="n">dispatcher_response</span><span class="o">.</span><span class="n">intent</span> <span class="o">==</span> <span class="n">IntentType</span><span class="o">.</span><span class="n">GENERATE_AGENT</span><span class="p">:</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>            <span class="c1"># Pass group context to agent generation</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>            <span class="n">generation_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_service</span><span class="o">.</span><span class="n">generate_agent</span><span class="p">(</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>                <span class="n">prompt_text</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>                <span class="n">model</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>                <span class="n">tools</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">tools</span><span class="p">,</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>                <span class="n">group_context</span><span class="o">=</span><span class="n">group_context</span>  <span class="c1"># Group context propagated</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>            <span class="p">)</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>        <span class="k">elif</span> <span class="n">dispatcher_response</span><span class="o">.</span><span class="n">intent</span> <span class="o">==</span> <span class="n">IntentType</span><span class="o">.</span><span class="n">GENERATE_TASK</span><span class="p">:</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>            <span class="c1"># Pass group context to task generation</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>            <span class="n">task_request</span> <span class="o">=</span> <span class="n">TaskGenerationRequest</span><span class="p">(</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>                <span class="n">text</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>                <span class="n">model</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>            <span class="p">)</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>            <span class="n">generation_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_service</span><span class="o">.</span><span class="n">generate_and_save_task</span><span class="p">(</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>                <span class="n">task_request</span><span class="p">,</span> 
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>                <span class="n">group_context</span>  <span class="c1"># Group context propagated</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>            <span class="p">)</span>
</code></pre></div>
<h2 id="individual-vs-group-permissions">Individual vs Group Permissions<a class="headerlink" href="#individual-vs-group-permissions" title="Permanent link">&para;</a></h2>
<h3 id="individual-mode">Individual Mode<a class="headerlink" href="#individual-mode" title="Permanent link">&para;</a></h3>
<ul>
<li>User has full admin rights over their private group</li>
<li>No collaboration features available</li>
<li>Complete isolation from other users</li>
<li>All RBAC privileges available within personal scope</li>
</ul>
<h3 id="group-mode">Group Mode<a class="headerlink" href="#group-mode" title="Permanent link">&para;</a></h3>
<ul>
<li>Permissions determined by role within each group</li>
<li>Can have different roles in different groups</li>
<li>Access to shared group resources</li>
<li>Role-based privilege restrictions apply</li>
</ul>
<h2 id="group-management">Group Management<a class="headerlink" href="#group-management" title="Permanent link">&para;</a></h2>
<h3 id="group-creation">Group Creation<a class="headerlink" href="#group-creation" title="Permanent link">&para;</a></h3>
<p><strong>Who Can Create:</strong>
- System administrators
- Users with appropriate permissions</p>
<p><strong>Process:</strong>
1. Admin creates group with unique identifier
2. Group gets assigned domain/namespace
3. Initial admin user assigned
4. Group becomes available for user assignment</p>
<h3 id="user-assignment">User Assignment<a class="headerlink" href="#user-assignment" title="Permanent link">&para;</a></h3>
<p><strong>Security Requirements:</strong>
- Must be performed by group admin or manager
- Explicit role assignment required
- Audit trail maintained for all changes</p>
<p><strong>Assignment Process:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Secure user assignment</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">group_service</span><span class="o">.</span><span class="n">assign_user_to_group</span><span class="p">(</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="n">group_id</span><span class="o">=</span><span class="s2">&quot;dev_team&quot;</span><span class="p">,</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="n">user_email</span><span class="o">=</span><span class="s2">&quot;alice@company.com&quot;</span><span class="p">,</span> 
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    <span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="n">assigned_by_email</span><span class="o">=</span><span class="s2">&quot;admin@company.com&quot;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="p">)</span>
</code></pre></div></p>
<h3 id="group-deletion">Group Deletion<a class="headerlink" href="#group-deletion" title="Permanent link">&para;</a></h3>
<p><strong>Security Safeguards:</strong>
- Only group admins can delete groups
- Confirmation required for destructive action
- All associated data permanently removed
- Users automatically moved to individual mode</p>
<h2 id="authentication-authorization">Authentication &amp; Authorization<a class="headerlink" href="#authentication-authorization" title="Permanent link">&para;</a></h2>
<h3 id="request-flow">Request Flow<a class="headerlink" href="#request-flow" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Authentication:</strong> User identity verified via headers/tokens</li>
<li><strong>Group Resolution:</strong> System determines user's group context</li>
<li><strong>Authorization:</strong> Request permissions validated against group access</li>
<li><strong>Data Filtering:</strong> Results filtered to accessible groups only</li>
</ol>
<h3 id="headers-context">Headers &amp; Context<a class="headerlink" href="#headers-context" title="Permanent link">&para;</a></h3>
<p><strong>Databricks Apps Integration:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="err">X-Forwarded-Email: alice@company.com</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="err">X-Forwarded-Access-Token: dapi1234567890abcdef</span>
</code></pre></div></p>
<p><strong>Mock Development Mode:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Development override for testing</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">MOCK_USER_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;alice@company.com&quot;</span>
</code></pre></div></p>
<h3 id="group-context-resolution">Group Context Resolution<a class="headerlink" href="#group-context-resolution" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">extract_group_context</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GroupContext</span><span class="p">:</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-Forwarded-Email&#39;</span><span class="p">)</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="c1"># Look up user&#39;s group memberships</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="n">user_groups</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_user_group_memberships</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user_groups</span><span class="p">:</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>        <span class="c1"># Individual mode - private group</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">generate_individual_group_id</span><span class="p">(</span><span class="n">email</span><span class="p">)]</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>        <span class="c1"># Group mode - shared groups</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">user_groups</span><span class="p">]</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    <span class="k">return</span> <span class="n">GroupContext</span><span class="p">(</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>        <span class="n">group_ids</span><span class="o">=</span><span class="n">group_ids</span><span class="p">,</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>        <span class="n">group_email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>        <span class="c1"># ... other fields</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>    <span class="p">)</span>
</code></pre></div>
<h2 id="security-guarantees">Security Guarantees<a class="headerlink" href="#security-guarantees" title="Permanent link">&para;</a></h2>
<h3 id="data-isolation-guarantees">Data Isolation Guarantees<a class="headerlink" href="#data-isolation-guarantees" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Individual Users:</strong> Cannot access other users' data</li>
<li><strong>Group Members:</strong> Can only access assigned group data</li>
<li><strong>Cross-Group:</strong> Users in multiple groups see combined data</li>
<li><strong>Admin Separation:</strong> Group admins cannot access other groups</li>
</ol>
<h3 id="audit-compliance">Audit &amp; Compliance<a class="headerlink" href="#audit-compliance" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Creation Tracking:</strong> All data includes creator information</li>
<li><strong>Access Logging:</strong> All data access logged with user context</li>
<li><strong>Change Audit:</strong> Group membership changes tracked</li>
<li><strong>Deletion Logs:</strong> Permanent deletion events recorded</li>
</ul>
<h3 id="data-retention">Data Retention<a class="headerlink" href="#data-retention" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Individual Data:</strong> Persists until user account deletion</li>
<li><strong>Group Data:</strong> Persists until group deletion</li>
<li><strong>Audit Logs:</strong> Retained according to compliance requirements</li>
<li><strong>Backup Security:</strong> Encrypted backups maintain tenant isolation</li>
</ul>
<h2 id="threat-model">Threat Model<a class="headerlink" href="#threat-model" title="Permanent link">&para;</a></h2>
<h3 id="threats-mitigated">Threats Mitigated<a class="headerlink" href="#threats-mitigated" title="Permanent link">&para;</a></h3>
<h4 id="1-unauthorized-data-access">1. <strong>Unauthorized Data Access</strong><a class="headerlink" href="#1-unauthorized-data-access" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Threat:</strong> User accessing another user's private data</li>
<li><strong>Mitigation:</strong> Individual tenant isolation with unique tenant IDs</li>
<li><strong>Detection:</strong> Query-level filtering prevents cross-tenant access</li>
</ul>
<h4 id="2-group-data-leakage">2. <strong>Group Data Leakage</strong><a class="headerlink" href="#2-group-data-leakage" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Threat:</strong> User accessing groups they don't belong to</li>
<li><strong>Mitigation:</strong> Explicit group membership validation</li>
<li><strong>Detection:</strong> All queries filtered by user's assigned tenant IDs</li>
</ul>
<h4 id="3-privilege-escalation">3. <strong>Privilege Escalation</strong><a class="headerlink" href="#3-privilege-escalation" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Threat:</strong> User gaining unauthorized permissions within group</li>
<li><strong>Mitigation:</strong> Role-based access control with explicit assignments</li>
<li><strong>Detection:</strong> Permission checks on every sensitive operation</li>
</ul>
<h4 id="4-admin-abuse">4. <strong>Admin Abuse</strong><a class="headerlink" href="#4-admin-abuse" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Threat:</strong> Group admin accessing other groups or individual data</li>
<li><strong>Mitigation:</strong> Admin permissions scoped to assigned groups only</li>
<li><strong>Detection:</strong> Audit logging of all admin actions</li>
</ul>
<h3 id="residual-risks">Residual Risks<a class="headerlink" href="#residual-risks" title="Permanent link">&para;</a></h3>
<h4 id="1-platform-admin-access">1. <strong>Platform Admin Access</strong><a class="headerlink" href="#1-platform-admin-access" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Risk:</strong> Platform administrators have database access</li>
<li><strong>Mitigation:</strong> Limited to necessary personnel, audit logging</li>
<li><strong>Monitoring:</strong> Database access logging and review</li>
</ul>
<h4 id="2-application-vulnerabilities">2. <strong>Application Vulnerabilities</strong><a class="headerlink" href="#2-application-vulnerabilities" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Risk:</strong> Security bugs could bypass tenant filtering</li>
<li><strong>Mitigation:</strong> Code review, security testing, tenant validation</li>
<li><strong>Monitoring:</strong> Automated security scanning, penetration testing</li>
</ul>
<h4 id="3-backupexport-data">3. <strong>Backup/Export Data</strong><a class="headerlink" href="#3-backupexport-data" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Risk:</strong> Data exports could contain cross-tenant information</li>
<li><strong>Mitigation:</strong> Export operations respect tenant boundaries</li>
<li><strong>Monitoring:</strong> Export audit logging and validation</li>
</ul>
<h2 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h2>
<h3 id="group-id-generation">Group ID Generation<a class="headerlink" href="#group-id-generation" title="Permanent link">&para;</a></h3>
<h4 id="individual-groups">Individual Groups<a class="headerlink" href="#individual-groups" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_individual_group_id</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate unique group ID for individual user.&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    <span class="n">sanitized</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;user_</span><span class="si">{</span><span class="n">sanitized</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="c1"># Examples:</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="c1"># alice@company.com  user_alice_company_com</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="c1"># bob.smith@startup.io  user_bob_smith_startup_io</span>
</code></pre></div>
<h4 id="shared-groups">Shared Groups<a class="headerlink" href="#shared-groups" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">generate_group_id</span><span class="p">(</span><span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate group ID for shared group.&quot;&quot;&quot;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="k">return</span> <span class="n">domain</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="c1"># Examples:</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="c1"># dev-team  dev_team</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="c1"># marketing.team  marketing_team</span>
</code></pre></div>
<h3 id="database-schema-security">Database Schema Security<a class="headerlink" href="#database-schema-security" title="Permanent link">&para;</a></h3>
<h4 id="group-columns">Group Columns<a class="headerlink" href="#group-columns" title="Permanent link">&para;</a></h4>
<p>All major tables include:
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">group_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">     </span><span class="c1">-- Primary isolation key</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">group_email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="w">           </span><span class="c1">-- Audit trail</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_group_id</span><span class="w"> </span><span class="p">(</span><span class="n">group_id</span><span class="p">),</span><span class="w">     </span><span class="c1">-- Query performance</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_group_email</span><span class="w"> </span><span class="p">(</span><span class="n">group_email</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Audit queries</span>
</code></pre></div></p>
<h4 id="foreign-key-constraints">Foreign Key Constraints<a class="headerlink" href="#foreign-key-constraints" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">-- Group membership table</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">group_users</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="n">group_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="k">role</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">,</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">groups</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">    </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">unique_user_group</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">group_id</span><span class="p">)</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="p">);</span>
</code></pre></div>
<h3 id="api-security-implementation">API Security Implementation<a class="headerlink" href="#api-security-implementation" title="Permanent link">&para;</a></h3>
<h4 id="group-context-dependency">Group Context Dependency<a class="headerlink" href="#group-context-dependency" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_group_context</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GroupContext</span><span class="p">:</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract and validate group context from request.&quot;&quot;&quot;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    <span class="n">context</span> <span class="o">=</span> <span class="k">await</span> <span class="n">extract_group_context_from_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">401</span><span class="p">,</span> <span class="s2">&quot;Invalid group context&quot;</span><span class="p">)</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    <span class="k">return</span> <span class="n">context</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="c1"># Usage in endpoints</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/executions/&quot;</span><span class="p">)</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_executions</span><span class="p">(</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>    <span class="n">group_context</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">GroupContext</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_group_context</span><span class="p">)]</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="p">):</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">execution_service</span><span class="o">.</span><span class="n">get_executions</span><span class="p">(</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>        <span class="n">group_ids</span><span class="o">=</span><span class="n">group_context</span><span class="o">.</span><span class="n">group_ids</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>    <span class="p">)</span>
</code></pre></div>
<h4 id="query-filtering">Query Filtering<a class="headerlink" href="#query-filtering" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_executions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Execution</span><span class="p">]:</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get executions with automatic group filtering.&quot;&quot;&quot;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">ExecutionHistory</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>        <span class="n">ExecutionHistory</span><span class="o">.</span><span class="n">group_id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>    <span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">ExecutionHistory</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div>
<h3 id="migration-upgrade-path">Migration &amp; Upgrade Path<a class="headerlink" href="#migration-upgrade-path" title="Permanent link">&para;</a></h3>
<h4 id="from-domain-based-to-hybrid-model">From Domain-Based to Hybrid Model<a class="headerlink" href="#from-domain-based-to-hybrid-model" title="Permanent link">&para;</a></h4>
<ol>
<li><strong>Backup existing data</strong> with current group assignments</li>
<li><strong>Run group migration</strong> to update individual users</li>
<li><strong>Create groups</strong> for collaborative teams</li>
<li><strong>Migrate team users</strong> to appropriate groups</li>
<li><strong>Validate data isolation</strong> post-migration</li>
</ol>
<h4 id="individual-user-migration">Individual User Migration<a class="headerlink" href="#individual-user-migration" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">migrate_to_individual_groups</span><span class="p">(</span><span class="n">user_email</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Migrate user from domain to individual groups.&quot;&quot;&quot;</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="n">old_group_id</span> <span class="o">=</span> <span class="n">generate_group_id</span><span class="p">(</span><span class="n">extract_domain</span><span class="p">(</span><span class="n">user_email</span><span class="p">))</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    <span class="n">new_group_id</span> <span class="o">=</span> <span class="n">generate_individual_group_id</span><span class="p">(</span><span class="n">user_email</span><span class="p">)</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    <span class="c1"># Update all user&#39;s data to new group ID</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="k">await</span> <span class="n">update_user_group_assignments</span><span class="p">(</span><span class="n">old_group_id</span><span class="p">,</span> <span class="n">new_group_id</span><span class="p">,</span> <span class="n">user_email</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>The Kasal security model provides robust multi-group isolation with flexible collaboration capabilities. By automatically adapting between individual and group modes, it ensures both privacy and productivity while maintaining strong security boundaries. The hybrid approach scales from individual developers to large collaborative teams without compromising security or usability.</p>
<p>For technical implementation details, see the source code in:
- <code>/src/utils/user_context.py</code> - Group context management
- <code>/src/core/dependencies.py</code> - Security dependencies
- <code>/src/services/group_service.py</code> - Group management
- <code>/src/api/group_router.py</code> - Admin API endpoints</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 7, 2025 21:17:05">June 7, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Kasal Team
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/yourusername/kasal" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "grid"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>